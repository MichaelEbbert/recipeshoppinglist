{% extends "base.html" %}

{% block title %}{% if recipe %}Edit{% else %}New{% endif %} Recipe - Recipe Shopping List{% endblock %}

{% block content %}
<div class="recipe-edit">
    <h1>{% if recipe %}Edit Recipe{% else %}New Recipe{% endif %}</h1>

    {% if unit_warnings %}
    <div class="unit-warnings">
        <h3>Warning: Unsupported Units Detected</h3>
        <p>The following ingredients use units that won't aggregate properly on shopping lists:</p>
        <ul>
            {% for warning in unit_warnings %}
            <li><strong>{{ warning.unit }}</strong> in "{{ warning.line }}"</li>
            {% endfor %}
        </ul>
        <p>Click the button again to save anyway, or edit the ingredients to use supported units.</p>
    </div>
    {% endif %}

    <form method="post" action="{% if recipe %}/recipes/{{ recipe.id }}/edit{% else %}/recipes/new{% endif %}">
        {% if unit_warnings %}
        <input type="hidden" name="confirm_unsupported" value="1">
        {% endif %}

        <div class="form-group">
            <label for="name">Recipe Name *</label>
            <input type="text" id="name" name="name" required
                   value="{{ name if name is defined else (recipe.name if recipe else '') }}">
        </div>

        <div class="form-group">
            <label for="description">Description</label>
            <textarea id="description" name="description" rows="2">{{ description if description is defined else (recipe.description if recipe else '') }}</textarea>
        </div>

        <div class="form-group">
            <label for="ingredients_text">Ingredients (one per line)</label>
            <textarea id="ingredients_text" name="ingredients_text" rows="10"
>{{ ingredients_text if ingredients_text else '' }}</textarea>
            <small>Format: quantity unit ingredient (e.g., "2 cups flour" or "1/2 tsp salt")</small>
        </div>

        <div class="form-group">
            <label for="instructions">Instructions</label>
            <textarea id="instructions" name="instructions" rows="10">{{ instructions if instructions is defined else (recipe.instructions if recipe else '') }}</textarea>
        </div>

        <div class="form-group">
            <label for="source_url">Source URL (optional)</label>
            <input type="text" id="source_url" name="source_url"
                   value="{{ source_url if source_url is defined else (recipe.source_url if recipe else '') }}">
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary{% if unit_warnings %} btn-warning{% endif %}">
                {% if unit_warnings %}
                    Save Anyway
                {% elif recipe %}
                    Save Changes
                {% else %}
                    Create Recipe
                {% endif %}
            </button>
            <a href="{% if recipe %}/recipes/{{ recipe.id }}{% else %}/recipes{% endif %}" class="btn">Cancel</a>
        </div>
    </form>
</div>
{% endblock %}
